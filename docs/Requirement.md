# 📦 e-Commerce 상품 주문 서비스 - 요구사항 정의서

## 📚 목차

1. [서비스 개요](#1-서비스-개요)
2. [도메인 요약](#2-도메인-요약)
3. [기능 명세 (API Specs)](#3-기능-명세-api-specs)
    - 3.1. 잔액 충전 / 조회 API
    - 3.2. 상품 조회 API
    - 3.3. 선착순 쿠폰 API
    - 3.4. 주문 / 결제 API
    - 3.5. 인기 상품 조회 API
4. [기능적 요구사항](#4-기능적-요구사항)
5. [비기능적 요구사항](#5-비기능적-요구사항)
6. [핵심 고려사항](#6-핵심-고려사항)

---

## 1. 서비스 개요

- `e-커머스 상품 주문 서비스`를 구현합니다.
- 상품 주문에 필요한 메뉴 정보들을 구성하고 조회할 수 있어야 합니다.
- 사용자는 여러 상품을 선택해 주문할 수 있으며, 미리 충전한 잔액을 이용해 결제합니다.
- 주문 내역을 기반으로 판매량이 높은 상품을 추천합니다.

---

## 2. 도메인 요약

| 도메인 | 설명 |
|--------|------|
| `User` | 사용자 정보, 잔액 관리 |
| `Product` | 상품 정보, 옵션, 재고 |
| `Coupon` | 쿠폰 발급, 사용, 검증 |
| `Order` | 주문 내역, 상태 |
| `Payment` | 결제 처리, 잔액 차감 |
| `Statistics` | 인기 상품 집계 및 조회 |

---

## 3. 기능 명세 (API Specs)

### 3.1. 잔액 충전 / 조회 API

- 잔액이 없으면 0을 반환합니다.
- 사용자가 직접 잔액을 충전할 수 있습니다.
- 충전 금액은 자연수이어야 합니다.
- 충전 내역은 잔고 이력 테이블에 저장됩니다.

### 3.2. 상품 조회 API

- 상품 목록을 조회할 수 있습니다.
- 상품 ID, 이름, 가격, 옵션, 재고 수량 등을 포함합니다.
- 품절(재고가 없는) 상태의 상품 옵션은 선택할 수 없습니다.

### 3.3. 선착순 쿠폰 API

- 유효한 조건을 충족한 경우에만 쿠폰을 발급받을 수 있습니다:
    - 유효기간 내
    - 수량이 남아 있음
    - 중복 발급되지 않음
- 발급된 쿠폰은 사용자에게 귀속되며, 중복 사용은 불가합니다.

### 3.4. 주문 / 결제 API

- 상품, 옵션, 수량, 쿠폰 정보로 주문 요청을 합니다.
- 충전된 잔액 기반으로만 결제가 가능합니다.
- 결제 성공 시:
    - 잔액 차감
    - 재고 차감
    - 결제 정보 저장
    - 외부 데이터 플랫폼으로 주문 정보 전송

### 3.5. 인기 상품 조회 API

- 최근 3일 기준 판매량을 집계하여 상위 5개 상품을 제공합니다.
- 매일 00시 30에 배치 작업으로 집계합니다.(서버 시간의 오차를 감안하여 30분 지연)

---

## 4. 기능적 요구사항

| 항목 | 내용 |
|------|------|
| 잔액 조회 | 잔액이 없으면 0 반환, 사용자 기준으로 잔액 조회 가능 |
| 잔액 충전 | 양수 충전, 최대 한도 초과 금지, 잔고 생성 또는 갱신 처리 |
| 상품 조회 | 상품 정보 및 옵션 포함, 품절 제외 |
| 쿠폰 발급 | 유효한 쿠폰만 발급, 중복 및 만료 검증 포함 |
| 쿠폰 사용 | 유효한 쿠폰만 사용 가능, 중복 사용 불가 |
| 주문 생성 | 상품 옵션, 수량, 쿠폰 정보 포함하여 생성 |
| 주문 유효성 | 재고, 상품 상태, 쿠폰 유효성 검증 |
| 결제 처리 | 잔액 차감, 결제 정보 저장, 외부 전송 포함 |
| 인기 상품 | 최근 3일 판매량 기준 집계, 상위 5개 조회 가능 |

---

## 5. 비기능적 요구사항

| 항목 | 내용                                                                       |
|------|--------------------------------------------------------------------------|
| 동시성 제어 | 쿠폰 발급, 잔액/재고 차감 시 경쟁 조건 방지                                               
| 데이터 정합성 | 주문, 결제, 잔액, 재고 간 트랜잭션 일관성 보장                                             |
| 성능 | 인기 상품 통계는 조회 빈도가 높을 것으로 예상되어 배치/캐시 고려 <br/> 상품 조회 요청에 대한 처리 시간은 2초 내로 보장 |
| 확장성 | Stateless 구조 기반 수평 확장 가능하게 구성         |

---

## 6. 핵심 고려사항

- **동시성 이슈 방지**
    - 잔액, 재고, 쿠폰 발급 모두에서 정합성 확보 필요
- **데이터 일관성 확보**
    - 주문/결제/잔액/재고는 모두 하나의 트랜잭션 내에서 처리
- **확장성 고려**
    - 다수의 인스턴스에서 동일하게 처리될 수 있도록 Stateless 설계